---
title: "2022-03-13: Myelin phagocytosis"
output: html_notebook
---

```{r include=FALSE}
library(tidyverse)
library(magrittr)
library(readxl)
library(lmerTest)
library(DHARMa)

theme_set(theme_bw())
```

## Data

Macrophages derived from Control (CT) and PD individuals were exposed to myelin prepared from CT individuals.

```{r}
df = read_xlsx("ctrl_myelin-macrophages.xlsx")

df

df %<>%
  pivot_longer(-TIME, values_to = "INT", names_to = "ID") %>%
  separate(ID, sep = 2, into = c("STATUS", NULL), remove = FALSE) %>%
  select(ID, STATUS, TIME, INT) %>%
  arrange(ID, TIME)

df
```

```{r}
ggplot(data = df, mapping = aes(x = TIME, y = INT, color = STATUS)) + geom_smooth(method = "loess", formula="y ~ x")
```
```{r}
ggplot(data = df, mapping = aes(x = TIME, y = INT, group = ID, color = STATUS)) +
  geom_point() +
  geom_line()
```

## Linear regression forcing intercept to zero

```{r}
ggplot(data = df, mapping = aes(x = TIME, y = INT, group = ID, color = STATUS)) + geom_smooth(method = "lm", formula="y ~ 0 + x", se = FALSE)
```

```{r}
m1.fit = lmer(INT ~ 0 + TIME*STATUS + (0 + TIME | ID), data=df)

summary(m1.fit)
```

```{r}
m1.res = simulateResiduals(fittedModel = m1.fit)
plot(m1.res)
```
## Linear regression forcing intercept to zero and up to 10 hours

```{r}
m2.fit = lmer(INT ~ 0 + TIME*STATUS + (0 + TIME | ID), data=df %>% filter(TIME <= 10))

summary(m2.fit)
```

```{r}
m2.res = simulateResiduals(fittedModel = m2.fit)
plot(m2.res)
```

## Linear regression not forcing intercept to zero

```{r}
ggplot(data = df, mapping = aes(x = TIME, y = INT, group = ID, color = STATUS)) + geom_smooth(method = "lm", formula="y ~ x", se = FALSE)
```


```{r}
m3.fit = lmer(INT ~ TIME*STATUS + (TIME | ID), data=df)

summary(m3.fit)
```

```{r}
m3.res = simulateResiduals(fittedModel = m3.fit)
plot(m3.res)
```
## Linear regression not forcing intercept to zero and up to 10 hours

```{r}
m4.fit = lmer(INT ~ TIME*STATUS + (TIME | ID), data=df %>% filter(TIME <= 10))

summary(m4.fit)
```

```{r}
m4.res = simulateResiduals(fittedModel = m4.fit)
plot(m4.res)
```

## Two-factor repeated-measures ANOVA

```{r}
df2 = df %>% mutate(TIME = as.factor(TIME), STATUS = as.factor(STATUS))
```

```{r}
ggplot(data = df2, mapping = aes(x = TIME, y = INT, color = STATUS)) +
  geom_boxplot()
```

```{r}
aov.res = aov(INT ~ STATUS + TIME + Error(ID / (TIME)), data = df2)
summary(aov.res)
```

---

See also:

- https://doi-org.eresources.mssm.edu/10.1016/j.buildenv.2021.108349
- https://doi.org/10.3758/s13423-017-1281-0